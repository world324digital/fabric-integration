# fabric-integration
Modified FabCar Code for REST API

## To run the script

Please run the hyperledger scripts by going to `fabric-samples/fabcar/`

`sh startFabric.sh javascript`

This will bootstrap the 2 org 2 node setup and install the javascript chaincode on the nodes.

## To run the API

#### Copy connection profile

Copy the connection profile generated by the step 1 above. The connection profile is located in
`/fabric-samples/first-network/connection-org1.json` 

Copy this profile inside `config` folder


#### Enroll Admin and User for the first time to connect to blockchain

```
node enrollAdmin.js
node registerUser.js
```

These commands will generate admin certificates and a user certificate for a user called `user1` and save them into the wallet folder.

#### Start the server

```
npm install
node start
```
This will start the express server at `http://localhost:3000`. If you are in GCP, it will start the server at `http://<your GCP external IP>:3000`. Please note that you have to enable the firewall rules to allow port 3000 to be exposed in your GCP Compute Engine.

To test the installation, initiate a `GET` request to `http://localhost:3000/query`



#### To install new chaincode

Put your chaincode in `/fabric-samples/chaincode/<your chaincode folder>/javascript/`. The chaincode folder is mounted in the docker container.

```
docker exec -it cli bash
peer chaincode install -l node -n fabcar -v 1.2 -p /opt/gopath/src/github.com/chaincode/<yourchaincode folder>/javascript/
```

Example for fabcar:

```
peer chaincode install -l node -n fabcar_new -v 1.2 -p /opt/gopath/src/github.com/chaincode/fabcar_new/javascript/

peer chaincode instantiate -o orderer.example.com:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n fabcar_new -v 1.2 -c '{"Args":["initLedger"]}' -P "OR ('Org1MSP.member','Org2MSP.member')"
```
